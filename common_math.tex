% TODO: check other dependencies, i.e. xparse, ?, i.e. don't fail, if they're 
% already loaded
% TODO: add ensuremath everywhere where appropriate
\usepackage{xparse}
\usepackage{ifthen,calc}

\usepackage{amsmath,amstext,amssymb,amsthm,amsfonts}
\usepackage{mathtools}
\usepackage{cancel}


% helpers
% TODO: use DeclarePairedDelimiter, also see
% http://tex.stackexchange.com/questions/23178/swap-definition-of-starred-and-non-starred-command/23214#23214
% http://tex.stackexchange.com/questions/278382/cause-declarepaireddelimiter-to-switch-starred-and-nonstarred-versions
\newcommand{\parenthesize}[1]{{\left(#1\right)}}
\newcommand{\bracketize}[1]{{\left[#1\right]}}


% symbols
% TODO: switch according to language, i.e. Spanish is cte.
\newcommand{\const}{\mathrm{const}}


% sets
\newcommand{\N}{\ensuremath{\mathbb{N}}}
\newcommand{\Z}{\ensuremath{\mathbb{Z}}}
\newcommand{\R}{\ensuremath{\mathbb{R}}}
\newcommand{\Q}{\ensuremath{\mathbb{Q}}}

\newcommand{\nats}{\N} % natural numbers
\newcommand{\natsz}{\ensuremath{\nats_{\mathrm{0}}}} % natural numbers incl. zero

\newcommand{\Pset}[1]{\ensuremath{\mathcal{P}\left(#1\right)}}


% norms etc.
\DeclarePairedDelimiter\abs{\lvert}{\rvert}
\DeclarePairedDelimiter\Abs{\left\lvert}{\right\rvert}
\DeclarePairedDelimiter\norm{\lVert}{\rVert}
\DeclarePairedDelimiter\Norm{\left\lVert}{\right\rVert}


% ranges
% TODO: let these accept a variable number of initial values, e.g.
% \idxrange{1}[1][2][3][5]{n}
\newcommand{\idxrange}[3]{{#1}_{#2}\dots{#1}_{#3}}
\newcommand{\idxrangec}[3]{{#1}_{#2},\dots{#1}_{#3}}  % comma-separated

% complex numbers
\newcommand{\conj}[1]{#1^{\ast}}


% vectors etc.
\newcommand{\vecb}[1]{\mathbf{#1}}
\newcommand{\colvec}[1]{\begin{pmatrix}#1\end{pmatrix}}


% operators
\newcommand{\adj}[1]{#1^{\dagger}}
\newcommand{\op}[1]{\hat{#1}}

\newcommand{\vecnabla}{\vec{\nabla}}
\newcommand{\grad}{\nabla}
\newcommand{\diverg}{\vecnabla\cdot}
\newcommand{\rot}{\vecnabla\times}


% calculus
\newcommand{\dif}{\mathrm{d}}
\newcommand{\Dif}{\mathrm{D}}
\newcommand{\postdif}[1]{\, \dif #1}
\newcommand{\PostDif}[1]{\, \Dif #1}
\newcommand{\predif}[1]{\dif #1 \,}
\newcommand{\PreDif}[1]{\Dif #1 \,}
\newcommand{\del}{\partial}

% Lebesgue formalism
\newcommand{\leb}{\ensuremath{\lambda}}

% functions
\newcommand{\func}[1]{\mathrm{#1}}
\newcommand{\expp}[1]{\func{e}^{#1}}
\newcommand{\expb}[1]{\exp\left(#1\right)}
\newcommand{\deltaf}[1]{\func{\delta} (#1)}
\newcommand{\asinh}{\func{asinh}}

% Derivatives

% TODO: automate these definitions for the various derivative commands \newcommand\defineDerivateCommand
\newcommand{\tderiv}[2]{\deriv{\dif}{#1}{#2}}
\newcommand{\pderiv}[2]{\deriv{\del}{#1}{#2}}
\newcommand{\fderiv}[2]{\deriv{\delta}{#1}{#2}}

% for convenience, wrap in parenthesis
% TODO: or make starred versions that parenthesize?
\newcommand{\ptderiv}[2]{\parenthesize{\deriv{\dif}{#1}{#2}}}
\newcommand{\ppderiv}[2]{\parenthesize{\deriv{\del}{#1}{#2}}}
\newcommand{\pfderiv}[2]{\parenthesize{\deriv{\delta}{#1}{#2}}}

% for convenience, wrap in brackets
\newcommand{\btderiv}[2]{\bracketize{\deriv{\dif}{#1}{#2}}}
\newcommand{\bpderiv}[2]{\bracketize{\deriv{\del}{#1}{#2}}}
\newcommand{\bfderiv}[2]{\bracketize{\deriv{\delta}{#1}{#2}}}

%------------------------------------------------------------

% TODO: automatically count order (command should be backwards-compatible to the above \totderiv so it can completely replace it)
\newcounter{derivordercounter}
% example: \deriv{\dif}{f}{x^2;y^3}
% example: \deriv{\partial}{f}{x^n;y^m}[n+m]  with an optional argument to overwrite the count
\NewDocumentCommand \deriv {m m o >{\SplitList{;}}m} {%
    % #1 - deriv sign
    % #2 - function
    % #3 - exponent overwrite for non-numerical cases
    % list - semicolon-separated list of variables, exponents given as usual with ^
    \IfNoValueTF{#3}{%
        % no \addtocounter overwrite: determine order, no output yet
        \ProcessList{#4}{\derivcountingsplitter}
        \frac{%
            \ifnum\value{derivordercounter}>1%
                % nothing, i.e. do not show exponent if it is 1
                #1^{\thederivordercounter} #2
            \else
                #1 #2
            \fi%
        }{%
            \let\derivsign#1
            \ProcessList{#4}{\derivadd}
        }
        \setcounter{derivordercounter}{0}
    }{%  else
        \frac{\dif^{#3} #2 }{%
            \let\derivsign#1
            \ProcessList{#4}{\derivadd}
        }
    }
}

\NewDocumentCommand \derivcountingsplitter {>{\SplitArgument{1}{^}}m} {%
    \derivcount#1
}

\NewDocumentCommand \derivcount {m m} {%
    %\addtocounter{derivordercounter}{\IfNoValueTF{#2}{1}{#2}}
}

\NewDocumentCommand \derivadd {m} {\derivsign #1}


% equation numbering
%http://tex.stackexchange.com/questions/42726/align-but-show-one-equation-number-at-the-end
\newcommand\numberthis{\addtocounter{equation}{1}\tag{\theequation}}

% vim: ts=4 sw=4 et :
