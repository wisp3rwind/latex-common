% TODO: check other dependencies, i.e. xparse, ?, i.e. don't fail, if they're 
% already loaded
% TODO: add ensuremath everywhere where appropriate
\usepackage{xparse}
\usepackage{calc}

\usepackage{amsmath,amstext,amssymb,amsthm,amsfonts}
\usepackage{mathtools}
\usepackage{cancel}
\usepackage{bm}


% helpers [[[1
% TODO: use DeclarePairedDelimiter, also see
% http://tex.stackexchange.com/questions/23178/swap-definition-of-starred-and-non-starred-command/23214#23214
% http://tex.stackexchange.com/questions/278382/cause-declarepaireddelimiter-to-switch-starred-and-nonstarred-versions
\newcommand{\parenthesize}[1]{{\left(#1\right)}}
\newcommand{\bracketize}[1]{{\left[#1\right]}}

% stolen from the physics package. Starred versions resize the delimiters
\DeclareDocumentCommand \argopen {s}{%
    \IfBooleanTF{#1}
        {\mathopen{}\mathclose\bgroup}
        {\mathopen{}\mathclose\bgroup\left}
}
\DeclareDocumentCommand \argclose {s}{%
    \IfBooleanTF{#1}
        {\egroup}
        {\aftergroup\egroup\right}
}

% symbols [[[1
% TODO: switch according to language, i.e. Spanish is cte.
\newcommand{\diffd}{\mathrm{d}}
\newcommand{\diffD}{\mathrm{D}}
\newcommand{\const}{\mathrm{const}}


% sets [[[1
\newcommand{\N}{\ensuremath{\mathbb{N}}}
\newcommand{\Z}{\ensuremath{\mathbb{Z}}}
\newcommand{\R}{\ensuremath{\mathbb{R}}}
\newcommand{\Q}{\ensuremath{\mathbb{Q}}}
\newcommand{\C}{\ensuremath{\mathbb{C}}}

\newcommand{\nats}{\N} % natural numbers
\newcommand{\natsz}{\ensuremath{\nats_{\mathrm{0}}}} % natural numbers incl. zero

\newcommand{\Pset}[1]{\ensuremath{\mathcal{P}\left(#1\right)}}


% norms etc. [[[1
\DeclarePairedDelimiter\abs{\lvert}{\rvert}
\DeclarePairedDelimiter\Abs{\left\lvert}{\right\rvert}
\DeclarePairedDelimiter\norm{\lVert}{\rVert}
\DeclarePairedDelimiter\Norm{\left\lVert}{\right\rVert}


% ranges [[[1
% TODO: let these accept a variable number of initial values, e.g.
% \idxrange{1}[1][2][3][5]{n}
\newcommand{\idxrange}[3]{{#1}_{#2}\dots{#1}_{#3}}
\newcommand{\idxrangec}[3]{{#1}_{#2},\dots,{#1}_{#3}}  % comma-separated

% complex numbers [[[1
\newcommand{\conj}[1]{#1^{\ast}}


% vectors etc. [[[1
% use \renewcommand{\vc}{\vec} in order to use over-arrows instead of a bold
% font
\newcommand{\vecb}[1]{\bm{#1}}  % bold vector
\newcommand{\vc}{\vecb}  % shorthand
\newcommand{\colvec}[1]{\begin{pmatrix}#1\end{pmatrix}}

% combinatorics [[[1
% \bincoef{N \\ k}
\newcommand{\bincoef}[1]{\ensuremath{\begin{pmatrix} #1 \end{pmatrix}}}

% operators [[[1
\newcommand{\adj}[1]{#1^{\dagger}}
\newcommand{\op}[1]{\hat{#1}}

% vector calculus [[[1
\newcommand{\vecnabla}{\vc{\nabla}}
\newcommand{\grad}{\nabla}
\renewcommand{\div}{\vecnabla\cdot}
\newcommand{\curl}{\vecnabla\times}
\newcommand{\laplacian}{\nabla^2}  % not a vector! -> non-bold
%\newcommand{\laplacian}{\Delta}


% calculus [[[1

% no-op helper
\NewDocumentCommand\nodifspacing{m}{#1}

% Differential symbol for use in integrals or in differential forms
\NewDocumentCommand\difsymbol{m m o g d()}{%
    % {#1} - boolean: whether to disable automatic spacing
    % {#2} - the symbol
    % [#3] - optional exponent, e.g. d^3 r
    % {#4} - the variable
    % (#5) - long form, e.g. d(cos x)
    \IfBooleanTF{#1}{\let\difspacing\nodifspacing}{\let\difspacing\mathinner}
    \IfNoValueTF{#4}{%
        \IfNoValueTF{#5}{%
% Never apply spacing if no argument is given
            #2 \IfValueT{#3}{^{#3}}
        }{%
% long form
            \difspacing{#2 \IfValueT{#3}{^{#3}} \argopen(#5\argclose)}
        }
    }{%
% normal form
        \difspacing{#2 \IfValueT{#3}{^{#3}} #4}
    }
}
\DeclareDocumentCommand\dif{s}{\difsymbol{#1}{\diffd}}
\DeclareDocumentCommand\Dif{s}{\difsymbol{#1}{\diffD}}
\DeclareDocumentCommand\var{s}{\difsymbol{#1}{\delta}}




\newcommand{\PreDif}[1]{\Dif #1 \,}
\newcommand{\del}{\partial}

% Lebesgue formalism
\newcommand{\leb}{\ensuremath{\lambda}}

% functions [[[1
\newcommand{\func}[1]{\mathrm{#1}}
\newcommand{\expp}[1]{\func{e}^{#1}}
\newcommand{\expb}[1]{\exp\left(#1\right)}
\newcommand{\deltaf}[1]{\func{\delta} (#1)}
\DeclareMathOperator{\asinh}{asinh}

% Derivatives [[[1

% TODO: automate these definitions for the various derivative commands \newcommand\defineDerivateCommand
\newcommand{\tderiv}[2]{\deriv{\dif}{#1}{#2}}
\newcommand{\pderiv}[2]{\deriv{\del}{#1}{#2}}
\newcommand{\fderiv}[2]{\deriv{\delta}{#1}{#2}}

% for convenience, wrap in parenthesis
% TODO: or make starred versions that parenthesize?
\newcommand{\ptderiv}[2]{\parenthesize{\deriv{\dif}{#1}{#2}}}
\newcommand{\ppderiv}[2]{\parenthesize{\deriv{\del}{#1}{#2}}}
\newcommand{\pfderiv}[2]{\parenthesize{\deriv{\delta}{#1}{#2}}}

% for convenience, wrap in brackets
\newcommand{\btderiv}[2]{\bracketize{\deriv{\dif}{#1}{#2}}}
\newcommand{\bpderiv}[2]{\bracketize{\deriv{\del}{#1}{#2}}}
\newcommand{\bfderiv}[2]{\bracketize{\deriv{\delta}{#1}{#2}}}

%------------------------------------------------------------

\newcounter{derivordercounter}
% example: \deriv{\dif}{f}{x^2;y^3}
% example: \deriv{\partial}{f}{x^n;y^m}[n+m]  with an optional argument to overwrite the count
\NewDocumentCommand \deriv {m m o >{\SplitList{;}}m} {%
    % #1 - deriv sign
    % #2 - function
    % #3 - exponent overwrite for non-numerical cases
    % list - semicolon-separated list of variables, exponents given as usual with ^
    \IfNoValueTF{#3}{%
        % no \addtocounter overwrite: determine order, no output yet
        \ProcessList{#4}{\derivcountingsplitter}
        \frac{%
            \ifnum\value{derivordercounter}>1%
                % nothing, i.e. do not show exponent if it is 1
                #1^{\thederivordercounter} #2
            \else
                #1 #2
            \fi%
        }{%
            \let\derivsign#1
            \ProcessList{#4}{\derivadd}
        }
        \setcounter{derivordercounter}{0}
    }{%  else
        \frac{\dif^{#3} #2 }{%
            \let\derivsign#1
            \ProcessList{#4}{\derivadd}
        }
    }
}

\NewDocumentCommand \derivcountingsplitter {>{\SplitArgument{1}{^}}m} {%
    \derivcount#1
}

\NewDocumentCommand \derivcount {m m} {%
    \addtocounter{derivordercounter}{\IfNoValueTF{#2}{1}{#2}}
}

\NewDocumentCommand \derivadd {m} {\derivsign #1}


% equation numbering [[[1
%http://tex.stackexchange.com/questions/42726/align-but-show-one-equation-number-at-the-end
\newcommand\numberthis{\addtocounter{equation}{1}\tag{\theequation}}


% Quick quad text (math-mode text with \quad spacing). [[[1
% Stolen from the physics package.
\DeclareDocumentCommand\qqtextinternal{m m}{\IfBooleanTF{#1}{}{\quad}\textnormal{#2}\quad}
\DeclareDocumentCommand\qqtext{s m}{\qqtext{#1}{#2}}
\DeclareDocumentCommand\qq{}{\qqtext}

\DeclareDocumentCommand\qcomma{}{,\quad}
\DeclareDocumentCommand\qc{}{\qcomma}

\DeclareDocumentCommand\qif{s}{\qqtextinternal{#1}{if}}
\DeclareDocumentCommand\qthen{s}{\qqtextinternal{#1}{then}}
\DeclareDocumentCommand\qelse{s}{\qqtextinternal{#1}{else}}
\DeclareDocumentCommand\qotherwise{s}{\qqtextinternal{#1}{otherwise}}
\DeclareDocumentCommand\qunless{s}{\qqtextinternal{#1}{unless}}
\DeclareDocumentCommand\qgiven{s}{\qqtextinternal{#1}{given}}
\DeclareDocumentCommand\qusing{s}{\qqtextinternal{#1}{using}}
\DeclareDocumentCommand\qassume{s}{\qqtextinternal{#1}{assume}}
\DeclareDocumentCommand\qsince{s}{\qqtextinternal{#1}{since}}
\DeclareDocumentCommand\qlet{s}{\qqtextinternal{#1}{let}}
\DeclareDocumentCommand\qfor{s}{\qqtextinternal{#1}{for}}
\DeclareDocumentCommand\qall{s}{\qqtextinternal{#1}{all}}
\DeclareDocumentCommand\qeven{s}{\qqtextinternal{#1}{even}}
\DeclareDocumentCommand\qodd{s}{\qqtextinternal{#1}{odd}}
\DeclareDocumentCommand\qinteger{s}{\qqtextinternal{#1}{integer}}
\DeclareDocumentCommand\qand{s}{\qqtextinternal{#1}{and}}
\DeclareDocumentCommand\qor{s}{\qqtextinternal{#1}{or}}
\DeclareDocumentCommand\qas{s}{\qqtextinternal{#1}{as}}
\DeclareDocumentCommand\qin{s}{\qqtextinternal{#1}{in}}
\DeclareDocumentCommand\qcc{s}{\qqtextinternal{#1}{c.c.}}

% vim: ts=4 sw=4 et fdm=marker fmr=[[[,]]]:
